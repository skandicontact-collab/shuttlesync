Hereâ€™s **the exact order** you should build ShuttleSync in â€” clean, linear, one-track, no chaos.
Follow this sequence and **everything will connect perfectly**.

---

# âœ… **PHASE 1 â€” FOUNDATION (DO NOT SKIP)**

### **Step 1 â€” Build Airtable bases (core data foundation)**

Create these 3 tables FIRST:

1ï¸âƒ£ **Employees**

* SK-ID
* Full Name
* Email
* PasswordHash
* Role (Host, Ops, Manager, Adminâ€¦)
* Status (Active/Inactive)
* Base
* 2FA Email
* etc.

2ï¸âƒ£ **Sessions**

* sessionToken
* SK-ID
* expiresAt
* createdAt
* IP (optional)
* device (optional)

3ï¸âƒ£ **Logs** (optional but recommended)

* loginSuccess
* loginFail
* 2FA sent
* magic link sent

ğŸ“Œ *Nothing else works until this is set up.*

---

# âœ… **PHASE 2 â€” AUTHENTICATION ENGINE (Make.com)**

Do **this BEFORE touching Wix pages or GitHub modules**.

### **Step 2 â€” Build the login scenario**

Make.com scenario:

* Trigger: **Custom Webhook â†’ login**
* Step: Airtable â†’ Find employee
* Step: Compare password hash
* If match â†’ create session row
* Return:

```json
{ "status":"success", "sessionToken":"..." }
```

### **Step 3 â€” Build the 2FA scenario**

* Trigger: webhook
* Generate 6-digit code
* Email employee
* Store code in Airtable
* Return OK

### **Step 4 â€” Build the 2FA verify scenario**

* Trigger: webhook
* Verify code
* Create session
* Return token

### **Step 5 â€” Build the token validation scenario**

This is used by *ALL* ShuttleSync pages.

* Trigger: webhook
* Look up sessionToken
* Check expiry
* Return: `"valid"` or `"invalid"`

ğŸ“Œ *Once these 4 are working, your entire login ecosystem exists.*

---

# âœ… **PHASE 3 â€” FRONTEND AUTH SYSTEM**

### **Step 6 â€” Build GitHub â€œShuttleSync Frontendâ€ structure**

Your repo should look like:

```
/auth
    login.html
    sessionManager.js
/intra
    dashboard.html
    profile.js
    training.js
/ops
    crewPlanning.html
/destination
    torGad.html
    torGas.html
/uniform
    index.html
```

### **Step 7 â€” Finalize login.html (iframe version)**

You already have this.

### **Step 8 â€” Build sessionManager.js**

Used in every dashboard page:

```
window.addEventListener("message", e => {
  if (e.data.type === "setSession")
      localStorage.setItem("skSession", JSON.stringify(e.data.payload));
});
```

This file gets loaded automatically by all GitHub pages.

---

# âœ… **PHASE 4 â€” WIX IMPLEMENTATION**

### **Step 9 â€” Create ShuttleSync Login page in Wix**

URL:
`/shuttlesync`

Add an iframe â†’ load:

```
https://YOUR_GITHUB_PATH/auth/login.html
```

Add listener to capture loginSuccess:

```js
window.addEventListener("message", (event) => {
  if(event.data.type === "loginSuccess"){
    localStorage.setItem("skSession", JSON.stringify(event.data.session));
    wixLocation.to("/shuttlesync/intra/dashboard");
  }
});
```

---

### **Step 10 â€” Add Auth Gate to ALL protected pages**

Add to **Page Code** at the top:

```js
const session = JSON.parse(localStorage.getItem("skSession") || null);

if(!session){
  wixLocation.to("/shuttlesync");
}
else {
  // verify with Make
  fetch("YOUR_VERIFY_TOKEN_WEBHOOK", {...})
}
```

This ensures:
âŒ no session â†’ redirect
âœ” valid â†’ load iframe

---

# âœ… **PHASE 5 â€” MODULES (GitHub â†’ Wix iframes)**

Now you can build modules one by one.

### **Step 11 â€” Add each GitHub module page to Wix via iframe**

Examples:

**Intra dashboard**

```
https://htmlpreview.github.io/?https://raw.githubusercontent.com/.../intra/dashboard.html
```

**Ops**

```
/ops/crewPlanning.html
```

**Destination**

```
/destination/torGad.html
```

**Uniform**

```
/uniform/index.html
```

ğŸ“Œ *ALL modules now share the same login & session system.*

---

# ğŸŸ¦ THE ONLY CORRECT ORDER (SUMMARY)

Memorize this:

```
1. Airtable Employees + Sessions
2. Make.com login scenario
3. Make.com 2FA scenario
4. Make.com token validation scenario
5. GitHub folder structure
6. login.html (iframe-safe)
7. sessionManager.js
8. Wix login page with iframe
9. Wix auth gate on each protected page
10. Add GitHub modules to Wix as iframes
```

If you do it in this exact order, ShuttleSync will work perfectly.

---

# â­ If you want, I can:

âœ” Generate all Airtable tables
âœ” Generate all Make.com scenarios
âœ” Generate full sessionManager.js
âœ” Generate Wix Auth Gate scripts
âœ” Generate GitHub folder templates

Just say:
**â€œGenerate all assets for Phase 1.â€**

